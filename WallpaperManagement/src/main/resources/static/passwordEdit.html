<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>修改密码</title>
    <link type="text/css" href="css/personalCenter.css" rel="stylesheet"/>
    <script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/jquery/2.1.3/jquery.min.js"></script>
    <script src="js/global.js"></script>
    <script>
        $(function () {
            // 获取所有的菜单项
            const menuItems = document.querySelectorAll('.leftdiv .menu a');
            // 获取当前页面的URL
            const currentPage = window.location.pathname;
            // 遍历所有的菜单项
            menuItems.forEach(item => {
                // 获取菜单项的跳转链接
                const link = item.getAttribute("href");
                // 如果链接与当前页面匹配，则为该菜单项添加 'active' 类
                if ("/" + link === currentPage) {
                    item.classList.add('active');
                }
            });
            $.ajax({
                url: "getCurrentInfo.action",
                type: "post",
                dataType: "json",
                success: function (user) {
                    $("#headImg").attr("src", "avatar/" + user.fileName + "?t=" + new Date().toString());
                }
            });
            //提交按钮
            $("#submit").click(function () {
                var oldpass = $("#oldpass").val();
                var newpass = $("#newpass").val();
                var renewpass = $("#renewpass").val();

                var flag = true;

                if (oldpass == "") {
                    alert("原始密码不许为空!");
                    flag = false;
                } else if (newpass == "") {
                    alert("新的密码不许为空!");
                    flag = false;
                } else if (renewpass == "") {
                    alert("重复密码不许为空!");
                    flag = false;
                } else if (newpass != renewpass) {
                    alert("新的密码和重复密码不一致！")
                    flag = false;
                }

                if (flag) {
                    $.ajax({
                        url: "updatePassword.action",
                        type: "post",
                        data: {
                            oldpass: oldpass,
                            newpass: newpass
                        },
                        success: function (data) {
                            if (data == 0) {
                                alert("修改失败！");
                            } else if (data == 1) {
                                alert("修改成功！");
                                window.location.href = "login.html";
                            } else if (data == 2) {
                                alert("原始密码错误！");
                                $("#oldpass").val("");
                            }
                        }
                    });
                }
            })
        })
    </script>
</head>
<body>
<div class="mainBag">
    <div class="background">
        <img src="images/5.png">
    </div>
</div>
<div class="leftdiv">
    <div class="profile">
        <img id="headImg">
    </div>
    <div class="menu">
        <ul>
            <li><a href="info.html">个人信息</a></li>
            <li><a href="infoEdit.html">修改信息</a></li>
            <li><a href="passwordEdit.html">修改密码</a></li>
        </ul>
    </div>
</div>
<div class="rightdiv">
    <div class="group">
        <div class="label">
            <label>原始密码：</label>
        </div>
        <div class="field">
            <input type="text" class="mess" id="oldpass"></input>
        </div>
    </div>
    <div class="group">
        <div class="label">
            <label>新的密码：</label>
        </div>
        <div class="field">
            <input type="text" class="mess" id="newpass"></input>
        </div>
    </div>
    <div class="group">
        <div class="label">
            <label>确认密码：</label>
        </div>
        <div class="field">
            <input type="text" class="mess" id="renewpass"></input>
        </div>
    </div>
    <div class="group">
        <div class="button">
            <button id="submit">提交</button>
        </div>
    </div>
</div>
<div class="but">
    <button id="return" onclick="window.location.replace('community.html');">
        <img src="images/return.png">
    </button>
</div>
</body>
</html>